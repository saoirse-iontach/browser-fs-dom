var BrowserFS_DOM=(()=>{var Le=Object.create;var M=Object.defineProperty;var $e=Object.getOwnPropertyDescriptor;var Ve=Object.getOwnPropertyNames;var qe=Object.getPrototypeOf,je=Object.prototype.hasOwnProperty;var c=(i,r)=>M(i,"name",{value:r,configurable:!0});var E=(i,r)=>()=>(r||i((r={exports:{}}).exports,r),r.exports),Ke=(i,r)=>{for(var e in r)M(i,e,{get:r[e],enumerable:!0})},pe=(i,r,e,t)=>{if(r&&typeof r=="object"||typeof r=="function")for(let n of Ve(r))!je.call(i,n)&&n!==e&&M(i,n,{get:()=>r[n],enumerable:!(t=$e(r,n))||t.enumerable});return i};var m=(i,r,e)=>(e=i!=null?Le(qe(i)):{},pe(r||!i||!i.__esModule?M(e,"default",{value:i,enumerable:!0}):e,i)),We=i=>pe(M({},"__esModule",{value:!0}),i);var C=E((st,me)=>{me.exports=BrowserFS});var ye=E((ot,he)=>{he.exports=BrowserFS});var oe=E((at,ge)=>{ge.exports=BrowserFS});var J=E((ct,be)=>{be.exports=BrowserFS});var ae=E((lt,we)=>{we.exports=BrowserFS});var Ce=E((_t,Pe)=>{Pe.exports=BrowserFS});var Ne=E((Bt,Te)=>{Te.exports=BrowserFS});var ke=E((qt,De)=>{De.exports=BrowserFS});var rt={};Ke(rt,{FileSystemAccessFile:()=>V,FileSystemAccessFileSystem:()=>R,HTTPRequest:()=>T,IndexedDBFileSystem:()=>A,IndexedDBROTransaction:()=>B,IndexedDBRWTransaction:()=>j,IndexedDBStore:()=>N,StorageFileSystem:()=>_,StorageStore:()=>W,WorkerFS:()=>v});function H(i,r){if(typeof i!="string")throw new TypeError(`"${r}" is not a string`)}c(H,"validateString");function ze(i,r){let e="",t=0,n=-1,s=0,o="\0";for(let a=0;a<=i.length;++a){if(a<i.length)o=i[a];else{if(o=="/")break;o="/"}if(o=="/"){if(!(n===a-1||s===1))if(s===2){if(e.length<2||t!==2||e.at(-1)!=="."||e.at(-2)!=="."){if(e.length>2){let l=e.lastIndexOf("/");l===-1?(e="",t=0):(e=e.slice(0,l),t=e.length-1-e.lastIndexOf("/")),n=a,s=0;continue}else if(e.length!==0){e="",t=0,n=a,s=0;continue}}r&&(e+=e.length>0?"/..":"..",t=2)}else e.length>0?e+="/"+i.slice(n+1,a):e=i.slice(n+1,a),t=a-n-1;n=a,s=0}else o==="."&&s!==-1?++s:s=-1}return e}c(ze,"normalizeString");function Ye(i){if(H(i,"path"),i.length===0)return".";let r=i[0]==="/",e=i.at(-1)==="/";return i=ze(i,!r),i.length===0?r?"/":e?"./":".":(e&&(i+="/"),r?`/${i}`:i)}c(Ye,"normalize");function L(...i){if(i.length===0)return".";let r;for(let e=0;e<i.length;++e){let t=i[e];H(t,"path"),t.length>0&&(r===void 0?r=t:r+=`/${t}`)}return r===void 0?".":Ye(r)}c(L,"join");function k(i){if(H(i,"path"),i.length===0)return".";let r=i[0]==="/",e=-1,t=!0;for(let n=i.length-1;n>=1;--n)if(i[n]==="/"){if(!t){e=n;break}}else t=!1;return e===-1?r?"/":".":r&&e===1?"//":i.slice(0,e)}c(k,"dirname");function $(i,r){r!==void 0&&H(r,"ext"),H(i,"path");let e=0,t=-1,n=!0;if(r!==void 0&&r.length>0&&r.length<=i.length){if(r===i)return"";let s=r.length-1,o=-1;for(let a=i.length-1;a>=0;--a)if(i[a]==="/"){if(!n){e=a+1;break}}else o===-1&&(n=!1,o=a+1),s>=0&&(i[a]===r[s]?--s===-1&&(t=a):(s=-1,t=o));return e===t?t=o:t===-1&&(t=i.length),i.slice(e,t)}for(let s=i.length-1;s>=0;--s)if(i[s]==="/"){if(!n){e=s+1;break}}else t===-1&&(n=!1,t=s+1);return t===-1?"":i.slice(e,t)}c($,"basename");var F=m(C(),1),Oe=m(ye(),1),ee=m(oe(),1),Ie=m(J(),1),O=m(ae(),1);var u;(function(i){i[i.EPERM=1]="EPERM",i[i.ENOENT=2]="ENOENT",i[i.EIO=5]="EIO",i[i.EBADF=9]="EBADF",i[i.EACCES=13]="EACCES",i[i.EBUSY=16]="EBUSY",i[i.EEXIST=17]="EEXIST",i[i.ENOTDIR=20]="ENOTDIR",i[i.EISDIR=21]="EISDIR",i[i.EINVAL=22]="EINVAL",i[i.EFBIG=27]="EFBIG",i[i.ENOSPC=28]="ENOSPC",i[i.EROFS=30]="EROFS",i[i.ENOTEMPTY=39]="ENOTEMPTY",i[i.ENOTSUP=95]="ENOTSUP"})(u=u||(u={}));var xe={[u.EPERM]:"Operation not permitted.",[u.ENOENT]:"No such file or directory.",[u.EIO]:"Input/output error.",[u.EBADF]:"Bad file descriptor.",[u.EACCES]:"Permission denied.",[u.EBUSY]:"Resource busy or locked.",[u.EEXIST]:"File exists.",[u.ENOTDIR]:"File is not a directory.",[u.EISDIR]:"File is a directory.",[u.EINVAL]:"Invalid argument.",[u.EFBIG]:"File is too big.",[u.ENOSPC]:"No space left on disk.",[u.EROFS]:"Cannot modify a read-only file system.",[u.ENOTEMPTY]:"Directory is not empty.",[u.ENOTSUP]:"Operation is not supported."},b=class extends Error{static fromJSON(r){let e=new b(r.errno,r.message,r.path);return e.code=r.code,e.stack=r.stack,e}static Derserialize(r,e=0){let t=new DataView("buffer"in r?r.buffer:r),n=Fe(t.buffer.slice(e+4,e+4+t.getUint32(e,!0)));return b.fromJSON(JSON.parse(n))}static FileError(r,e){return new b(r,xe[r],e)}static EACCES(r){return this.FileError(u.EACCES,r)}static ENOENT(r){return this.FileError(u.ENOENT,r)}static EEXIST(r){return this.FileError(u.EEXIST,r)}static EISDIR(r){return this.FileError(u.EISDIR,r)}static ENOTDIR(r){return this.FileError(u.ENOTDIR,r)}static EPERM(r){return this.FileError(u.EPERM,r)}static ENOTEMPTY(r){return this.FileError(u.ENOTEMPTY,r)}constructor(r,e=xe[r],t){super(e),this.syscall="",this.errno=r,this.code=u[r],this.path=t,this.message=`Error: ${this.code}: ${e}${this.path?`, '${this.path}'`:""}`}toString(){return this.message}toJSON(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}}serialize(r=new Uint8Array(this.bufferSize()),e=0){let t=new DataView("buffer"in r?r.buffer:r),n=new Uint8Array(t.buffer),s=Se(JSON.stringify(this.toJSON()));return n.set(s),t.setUint32(e,s.byteLength,!0),n}bufferSize(){return 4+JSON.stringify(this.toJSON()).length}};c(b,"ApiError");function G(i,r,e,t,n){return Math.min(i+1,r+1,e+1,t===n?r:r+1)}c(G,"_min");function Je(i,r){if(i===r)return 0;i.length>r.length&&([i,r]=[r,i]);let e=i.length,t=r.length;for(;e>0&&i.charCodeAt(e-1)===r.charCodeAt(t-1);)e--,t--;let n=0;for(;n<e&&i.charCodeAt(n)===r.charCodeAt(n);)n++;if(e-=n,t-=n,e===0||t===1)return t;let s=new Array(e<<1);for(let y=0;y<e;)s[e+y]=i.charCodeAt(n+y),s[y]=++y;let o,a,l,d,p;for(o=0;o+3<t;){let y=r.charCodeAt(n+(a=o)),P=r.charCodeAt(n+(l=o+1)),D=r.charCodeAt(n+(d=o+2)),He=r.charCodeAt(n+(p=o+3)),se=o+=4;for(let Y=0;Y<e;){let X=s[e+Y],de=s[Y];a=G(de,a,l,y,X),l=G(a,l,d,P,X),d=G(l,d,p,D,X),se=G(d,p,se,He,X),s[Y++]=se,p=d,d=l,l=a,a=de}}let f=0;for(;o<t;){let y=r.charCodeAt(n+(a=o));f=++o;for(let P=0;P<e;P++){let D=s[P];s[P]=f=D<a||f<a?D>f?f+1:D+1:y===s[e+P]?a:a+1,a=D}}return f}c(Je,"levenshtein");async function Ee(i,r){let e=i.Options,t=i.Name,n=0,s=!1,o=!1;for(let a in e)if(Object.prototype.hasOwnProperty.call(e,a)){let l=e[a],d=r&&r[a];if(d==null){if(!l.optional){let p=Object.keys(r).filter(f=>!(f in e)).map(f=>({str:f,distance:Je(a,f)})).filter(f=>f.distance<5).sort((f,y)=>f.distance-y.distance);if(s)return;throw s=!0,new b(u.EINVAL,`[${t}] Required option '${a}' not provided.${p.length>0?` You provided unrecognized option '${p[0].str}'; perhaps you meant to type '${a}'.`:""}
Option description: ${l.description}`)}}else{let p=!1;if(Array.isArray(l.type)?p=l.type.indexOf(typeof d)!==-1:p=typeof d===l.type,p){if(l.validator){n++;try{await l.validator(d)}catch(f){if(!s){if(f)throw s=!0,f;if(n--,n===0&&o)return}}}}else{if(s)return;throw s=!0,new b(u.EINVAL,`[${t}] Value provided for option ${a} is not the proper type. Expected ${Array.isArray(l.type)?`one of {${l.type.join(", ")}}`:l.type}, but received ${typeof d}
Option description: ${l.description}`)}}}o=!0}c(Ee,"checkOptions");var mt=typeof globalThis.setImmediate=="function"?globalThis.setImmediate:i=>setTimeout(i,0);function Se(i,r="utf8"){let e=i||"";switch(r){default:case"utf8":case"utf-8":return new TextEncoder().encode(e);case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return new Uint8Array(Uint16Array.from(e.split(""),t=>t.charCodeAt(0)).buffer);case"ascii":case"latin1":case"binary":return Uint8Array.from(e.split(""),t=>t.charCodeAt(0));case"hex":return Uint8Array.from(e.match(/../g),t=>parseInt(t,16));case"base64":case"base64url":return e=e.replaceAll("-","+").replaceAll("_","/"),Uint8Array.from(atob(e).split(""),t=>t.charCodeAt(0))}}c(Se,"encode");function Fe(i,r="utf8"){if(!i||!i.byteLength)return"";let e=new Uint8Array("buffer"in i?i.buffer:i);switch(r){default:case"utf8":case"utf-8":return new TextDecoder("utf-8").decode(e);case"utf16le":case"utf-16le":case"ucs2":case"ucs-2":return new TextDecoder("utf-16le").decode(e);case"ascii":return new TextDecoder("utf-8").decode(e.map(t=>t&127));case"latin1":case"binary":return new TextDecoder("utf-16").decode(new Uint8Array(Uint16Array.from(e).buffer));case"hex":return Array.from(e,t=>t.toString(16).padStart(2,"0")).join("");case"base64":return btoa(new TextDecoder("utf-16").decode(new Uint8Array(Uint16Array.from(e).buffer)));case"base64url":return btoa(new TextDecoder("utf-16").decode(new Uint8Array(Uint16Array.from(e).buffer))).replaceAll("+","-").replaceAll("/","_").replaceAll("=","")}}c(Fe,"decode");function w(i,r){r=typeof i=="function"?i:r,Ee(this,i);let e=new this(typeof i=="function"?{}:i);if(typeof r!="function")return e.whenReady();e.whenReady().then(t=>r(null,t)).catch(t=>r(t))}c(w,"CreateBackend");var Q=c((i="",r)=>{throw r.name==="NotFoundError"?F.ApiError.ENOENT(i):r},"handleError"),V=class extends ee.PreloadFile{constructor(r,e,t,n,s){super(r,e,t,n,s)}async sync(){this.isDirty()&&(await this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),Oe.Cred.Root),this.resetDirty())}async close(){await this.sync()}};c(V,"FileSystemAccessFile");var Z=class extends Ie.BaseFileSystem{constructor({handle:e}){super();this._handles=new Map;this._handles.set("/",e)}static isAvailable(){return typeof FileSystemHandle=="function"}get metadata(){return{...super.metadata,name:Z.Name}}async _sync(e,t,n,s){let o=await this.stat(e,s);n.mtime!==o.mtime&&await this.writeFile(e,t,ee.FileFlag.getFileFlag("w"),o.mode,s)}async rename(e,t,n){try{let s=await this.getHandle(e);if(s instanceof FileSystemDirectoryHandle){let o=await this.readdir(e,n);if(await this.mkdir(t,"wx",n),o.length===0)await this.unlink(e,n);else for(let a of o)await this.rename(L(e,a),L(t,a),n),await this.unlink(e,n)}if(s instanceof FileSystemFileHandle){let o=await s.getFile(),a=await this.getHandle(k(t));if(a instanceof FileSystemDirectoryHandle){let d=await(await a.getFileHandle($(t),{create:!0})).createWritable(),p=await o.arrayBuffer();await d.write(p),d.close(),await this.unlink(e,n)}}}catch(s){Q(e,s)}}async writeFile(e,t,n,s,o,a){let l=await this.getHandle(k(e));if(l instanceof FileSystemDirectoryHandle){let p=await(await l.getFileHandle($(e),{create:!0})).createWritable();await p.write(t),await p.close()}}async createFile(e,t,n,s){return await this.writeFile(e,new Uint8Array,t,n,s,!0),this.openFile(e,t,s)}async stat(e,t){let n=await this.getHandle(e);if(!n)throw F.ApiError.FileError(F.ErrorCode.EINVAL,e);if(n instanceof FileSystemDirectoryHandle)return new O.Stats(O.FileType.DIRECTORY,4096);if(n instanceof FileSystemFileHandle){let{lastModified:s,size:o}=await n.getFile();return new O.Stats(O.FileType.FILE,o,void 0,void 0,s)}}async exists(e,t){try{return await this.getHandle(e),!0}catch{return!1}}async openFile(e,t,n){let s=await this.getHandle(e);if(s instanceof FileSystemFileHandle){let o=await s.getFile(),a=await o.arrayBuffer();return this.newFile(e,t,a,o.size,o.lastModified)}}async unlink(e,t){let n=await this.getHandle(k(e));if(n instanceof FileSystemDirectoryHandle)try{await n.removeEntry($(e),{recursive:!0})}catch(s){Q(e,s)}}async rmdir(e,t){return this.unlink(e,t)}async mkdir(e,t,n){let s=t&&t.flag&&t.flag.includes("w")&&!t.flag.includes("x");if(await this.getHandle(e)&&!s)throw F.ApiError.EEXIST(e);let a=await this.getHandle(k(e));a instanceof FileSystemDirectoryHandle&&await a.getDirectoryHandle($(e),{create:!0})}async readdir(e,t){let n=await this.getHandle(e);if(!(n instanceof FileSystemDirectoryHandle))throw F.ApiError.ENOTDIR(e);let s=[];for await(let o of n.keys())s.push(L(e,o));return s}newFile(e,t,n,s,o){return new V(this,e,t,new O.Stats(O.FileType.FILE,s||0,void 0,void 0,o||new Date().getTime()),new Uint8Array(n))}async getHandle(e){if(this._handles.has(e))return this._handles.get(e);let t="/",[,...n]=e.split("/"),s=c(async([o,...a])=>{let l=L(t,o),d=c(f=>{if(t=l,this._handles.set(t,f),a.length===0)return this._handles.get(e);s(a)},"continueWalk"),p=this._handles.get(t);try{return await d(await p.getDirectoryHandle(o))}catch(f){if(f.name==="TypeMismatchError")try{return await d(await p.getFileHandle(o))}catch(y){Q(l,y)}else{if(f.message==="Name is not allowed.")throw new F.ApiError(F.ErrorCode.ENOENT,f.message,l);Q(l,f)}}},"getHandleParts");await s(n)}},R=Z;c(R,"FileSystemAccessFileSystem"),R.Name="FileSystemAccess",R.Create=w.bind(Z),R.Options={};var Re=m(J(),1),h=m(C(),1),I=m(oe(),1),le=m(ae(),1);var x=m(C(),1);var Ae=typeof fetch<"u"&&fetch!==null;function te(i){throw new x.ApiError(x.ErrorCode.EIO,i.message)}c(te,"convertError");async function ce(i,r){let e=await fetch(i).catch(te);if(!e.ok)throw new x.ApiError(x.ErrorCode.EIO,`fetch error: response returned code ${e.status}`);switch(r){case"buffer":let t=await e.arrayBuffer().catch(te);return new Uint8Array(t);case"json":return e.json().catch(te);default:throw new x.ApiError(x.ErrorCode.EINVAL,"Invalid download type: "+r)}}c(ce,"fetchFile");async function _e(i){let r=await fetch(i,{method:"HEAD"}).catch(te);if(!r.ok)throw new x.ApiError(x.ErrorCode.EIO,`fetch HEAD error: response returned code ${r.status}`);return parseInt(r.headers.get("Content-Length")||"-1",10)}c(_e,"fetchFileSize");var S=m(Ce(),1);var re=class extends Re.BaseFileSystem{constructor({index:e,baseUrl:t=""}){super();e||(e="index.json");let n=typeof e=="string"?ce(e,"json"):Promise.resolve(e);this._ready=n.then(s=>(this._index=S.FileIndex.fromListing(s),this)),t.length>0&&t.charAt(t.length-1)!=="/"&&(t=t+"/"),this.prefixUrl=t}static isAvailable(){return Ae}get metadata(){return{...super.metadata,name:re.Name,readonly:!0}}empty(){this._index.fileIterator(function(e){e.fileData=null})}preloadFile(e,t){let n=this._index.getInode(e);if((0,S.isIndexFileInode)(n)){if(n===null)throw h.ApiError.ENOENT(e);let s=n.getData();s.size=t.length,s.fileData=t}else throw h.ApiError.EISDIR(e)}async stat(e,t){let n=this._index.getInode(e);if(n===null)throw h.ApiError.ENOENT(e);if(!n.toStats().hasAccess(4,t))throw h.ApiError.EACCES(e);let s;if((0,S.isIndexFileInode)(n))s=n.getData(),s.size<0&&(s.size=await this._requestFileSize(e));else if((0,S.isIndexDirInode)(n))s=n.getStats();else throw h.ApiError.FileError(h.ErrorCode.EINVAL,e);return s}async open(e,t,n,s){if(t.isWriteable())throw new h.ApiError(h.ErrorCode.EPERM,e);let o=this._index.getInode(e);if(o===null)throw h.ApiError.ENOENT(e);if(!o.toStats().hasAccess(t.getMode(),s))throw h.ApiError.EACCES(e);if((0,S.isIndexFileInode)(o)||(0,S.isIndexDirInode)(o))switch(t.pathExistsAction()){case I.ActionType.THROW_EXCEPTION:case I.ActionType.TRUNCATE_FILE:throw h.ApiError.EEXIST(e);case I.ActionType.NOP:if((0,S.isIndexDirInode)(o)){let d=o.getStats();return new I.NoSyncFile(this,e,t,d,d.fileData||void 0)}let a=o.getData();if(a.fileData)return new I.NoSyncFile(this,e,t,le.Stats.clone(a),a.fileData);let l=await this._requestFile(e,"buffer");return a.size=l.length,a.fileData=l,new I.NoSyncFile(this,e,t,le.Stats.clone(a),l);default:throw new h.ApiError(h.ErrorCode.EINVAL,"Invalid FileMode object.")}else throw h.ApiError.EPERM(e)}async readdir(e,t){return this.readdirSync(e,t)}async readFile(e,t,n){let s=await this.open(e,t,420,n);try{return s.getBuffer()}finally{await s.close()}}_getHTTPPath(e){return e.charAt(0)==="/"&&(e=e.slice(1)),this.prefixUrl+e}_requestFile(e,t){return ce(this._getHTTPPath(e),t)}_requestFileSize(e){return _e(this._getHTTPPath(e))}},T=re;c(T,"HTTPRequest"),T.Name="HTTPRequest",T.Create=w.bind(re),T.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_http_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."}};var ve=m(Ne(),1),g=m(C(),1);function q(i,r=i.toString()){switch(i.name){case"NotFoundError":return new g.ApiError(g.ErrorCode.ENOENT,r);case"QuotaExceededError":return new g.ApiError(g.ErrorCode.ENOSPC,r);default:return new g.ApiError(g.ErrorCode.EIO,r)}}c(q,"convertError");function K(i,r=g.ErrorCode.EIO,e=null){return function(t){t.preventDefault(),i(new g.ApiError(r,e!==null?e:void 0))}}c(K,"onErrorHandler");var B=class{constructor(r,e){this.tx=r;this.store=e}get(r){return new Promise((e,t)=>{try{let n=this.store.get(r);n.onerror=K(t),n.onsuccess=s=>{let o=s.target.result;e(o===void 0?o:Uint8Array.from(o))}}catch(n){t(q(n))}})}};c(B,"IndexedDBROTransaction");var j=class extends B{constructor(r,e){super(r,e)}put(r,e,t){return new Promise((n,s)=>{try{let o=t?this.store.put(e,r):this.store.add(e,r);o.onerror=K(s),o.onsuccess=()=>{n(!0)}}catch(o){s(q(o))}})}del(r){return new Promise((e,t)=>{try{let n=this.store.delete(r);n.onerror=K(t),n.onsuccess=()=>{e()}}catch(n){t(q(n))}})}commit(){return new Promise(r=>{setTimeout(r,0)})}abort(){return new Promise((r,e)=>{try{this.tx.abort(),r()}catch(t){e(q(t))}})}};c(j,"IndexedDBRWTransaction");var N=class{constructor(r,e){this.db=r;this.storeName=e}static Create(r,e){return new Promise((t,n)=>{let s=e.open(r,1);s.onupgradeneeded=o=>{let a=o.target.result;a.objectStoreNames.contains(r)&&a.deleteObjectStore(r),a.createObjectStore(r)},s.onsuccess=o=>{t(new N(o.target.result,r))},s.onerror=K(n,g.ErrorCode.EACCES)})}name(){return A.Name+" - "+this.storeName}clear(){return new Promise((r,e)=>{try{let t=this.db.transaction(this.storeName,"readwrite"),n=t.objectStore(this.storeName),s=n.clear();s.onsuccess=()=>{setTimeout(r,0)},s.onerror=K(e)}catch(t){e(q(t))}})}beginTransaction(r="readonly"){let e=this.db.transaction(this.storeName,r),t=e.objectStore(this.storeName);if(r==="readwrite")return new j(e,t);if(r==="readonly")return new B(e,t);throw new g.ApiError(g.ErrorCode.EINVAL,"Invalid transaction type.")}};c(N,"IndexedDBStore");var ue=class extends ve.AsyncKeyValueFileSystem{static isAvailable(r=globalThis.indexedDB){try{if(!(r instanceof IDBFactory)||!r.open("__browserfs_test__"))return!1}catch{return!1}}constructor({cacheSize:r=100,storeName:e="browserfs",idbFactory:t=globalThis.indexedDB}){super(r),this._ready=N.Create(e,t).then(n=>(this.init(n),this))}},A=ue;c(A,"IndexedDBFileSystem"),A.Name="IndexedDB",A.Create=w.bind(ue),A.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."},cacheSize:{type:"number",optional:!0,description:"The size of the inode cache. Defaults to 100. A size of 0 or below disables caching."},idbFactory:{type:"object",optional:!0,description:"The IDBFactory to use. Defaults to globalThis.indexedDB."}};var ie=m(ke(),1),U=m(C(),1);var Qe=c(i=>String.fromCodePoint(i>>11!==27?i:i|65536),"itoc"),Ze=c(i=>i.codePointAt(0),"ctoi"),et=new Int16Array(Int8Array.from([-1,0]).buffer)[0]<0?(i,r)=>String.fromCodePoint(i<<8|r):(i,r)=>String.fromCharCode(i|r<<8);function Be(i){let{length:r,buffer:e,byteOffset:t,byteLength:n}=i,s=t%2,o=n%2,a;s&&(i=new Uint8Array(e,--t,n+1),a=i[0],i.copyWithin(0,1));let l=new Uint16Array(e,t,n>>1),d=o&&i[r-1],p=2-o,f=Array.from(l,Qe);return f.push(et(d,p)),s&&(i.copyWithin(1,0),i[0]=a),f.join("")}c(Be,"utf16Encode");function Ue(i){let r=Uint16Array.from(i,Ze),e=new Uint8Array(r.buffer),{length:t,buffer:n}=e,s=e[t-1];return new Uint8Array(n.slice(0,t-s))}c(Ue,"utf16Decode");var W=class{constructor(r){this._storage=r}name(){return _.Name}clear(){this._storage.clear()}beginTransaction(r){return new ie.SimpleSyncRWTransaction(this)}get(r){let e=this._storage.getItem(r);if(typeof e=="string")return Ue(e)}put(r,e,t){try{return!t&&this._storage.getItem(r)!==null?!1:(this._storage.setItem(r,Be(e)),!0)}catch{throw new U.ApiError(U.ErrorCode.ENOSPC,"Storage is full.")}}del(r){try{this._storage.removeItem(r)}catch(e){throw new U.ApiError(U.ErrorCode.EIO,"Unable to delete key "+r+": "+e)}}};c(W,"StorageStore");var fe=class extends ie.SyncKeyValueFileSystem{static isAvailable(r=globalThis.localStorage){return r instanceof Storage}constructor({storage:r=globalThis.localStorage}){super({store:new W(r)})}},_=fe;c(_,"StorageFileSystem"),_.Name="Storage",_.Create=w.bind(fe),_.Options={storage:{type:"object",optional:!0,description:"The Storage to use. Defaults to globalThis.localStorage."}};var Me=m(J(),1),z=m(C(),1);function tt(i){return typeof i=="object"&&"isBFS"in i&&!!i.isBFS}c(tt,"isRPCMessage");var ne=class extends Me.BaseFileSystem{constructor({worker:e}){super();this._currentID=0;this._requests=new Map;this._isInitialized=!1;this._worker=e,this._worker.onmessage=t=>{if(!tt(t.data))return;let{id:n,method:s,value:o}=t.data;if(s==="metadata"){this._metadata=o,this._isInitialized=!0;return}let{resolve:a,reject:l}=this._requests.get(n);if(this._requests.delete(n),o instanceof Error||o instanceof z.ApiError){l(o);return}a(o)}}static isAvailable(){return typeof importScripts<"u"||typeof Worker<"u"}get metadata(){return{...super.metadata,...this._metadata,name:ne.Name,synchronous:!1}}async _rpc(e,...t){return new Promise((n,s)=>{let o=this._currentID++;this._requests.set(o,{resolve:n,reject:s}),this._worker.postMessage({isBFS:!0,id:o,method:e,args:t})})}rename(e,t,n){return this._rpc("rename",e,t,n)}stat(e,t){return this._rpc("stat",e,t)}open(e,t,n,s){return this._rpc("open",e,t,n,s)}unlink(e,t){return this._rpc("unlink",e,t)}rmdir(e,t){return this._rpc("rmdir",e,t)}mkdir(e,t,n){return this._rpc("mkdir",e,t,n)}readdir(e,t){return this._rpc("readdir",e,t)}exists(e,t){return this._rpc("exists",e,t)}realpath(e,t){return this._rpc("realpath",e,t)}truncate(e,t,n){return this._rpc("truncate",e,t,n)}readFile(e,t,n){return this._rpc("readFile",e,t,n)}writeFile(e,t,n,s,o){return this._rpc("writeFile",e,t,n,s,o)}appendFile(e,t,n,s,o){return this._rpc("appendFile",e,t,n,s,o)}chmod(e,t,n){return this._rpc("chmod",e,t,n)}chown(e,t,n,s){return this._rpc("chown",e,t,n,s)}utimes(e,t,n,s){return this._rpc("utimes",e,t,n,s)}link(e,t,n){return this._rpc("link",e,t,n)}symlink(e,t,n,s){return this._rpc("symlink",e,t,n,s)}readlink(e,t){return this._rpc("readlink",e,t)}syncClose(e,t){return this._rpc("syncClose",e,t)}},v=ne;c(v,"WorkerFS"),v.Name="WorkerFS",v.Create=w.bind(ne),v.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator(e){if(typeof e?.postMessage!="function")throw new z.ApiError(z.ErrorCode.EINVAL,"option must be a Web Worker instance.")}}};return We(rt);})();
//# sourceMappingURL=browser.min.js.map
